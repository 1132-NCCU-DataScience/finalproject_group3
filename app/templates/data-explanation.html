{% extends "base.html" %}

{% block title %}資料說明 - Starlink 台北衛星覆蓋分析中心{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">首頁</a></li>
        <li class="breadcrumb-item active">資料說明</li>
    </ol>
</nav>
{% endblock %}

{% block extra_css %}
<style>
    .section-card {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 25px;
        border-left: 5px solid #667eea;
        transition: all 0.3s ease;
    }
    
    .section-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .section-title {
        color: #4a5568;
        font-weight: 600;
        font-size: 1.4em;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .section-icon {
        color: #667eea;
        font-size: 1.3em;
    }
    
    .subsection {
        margin-bottom: 20px;
    }
    
    .subsection h4 {
        color: #667eea;
        font-weight: 600;
        margin-bottom: 10px;
        font-size: 1.1em;
    }
    
    .data-source-item {
        background: rgba(102, 126, 234, 0.1);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
    }
    
    .formula-box {
        background: #e9ecef;
        border: 1px solid #ced4da;
        border-radius: 8px;
        padding: 15px;
        font-family: 'Courier New', monospace;
        margin: 10px 0;
        overflow-x: auto;
    }
    
    .highlight-box {
        background: rgba(40, 167, 69, 0.1);
        border-left: 4px solid #28a745;
        padding: 15px;
        border-radius: 0 8px 8px 0;
        margin: 15px 0;
    }
    
    .warning-box {
        background: rgba(255, 193, 7, 0.1);
        border-left: 4px solid #ffc107;
        padding: 15px;
        border-radius: 0 8px 8px 0;
        margin: 15px 0;
    }
    
    .chart-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 15px;
    }
    
    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 3px;
    }
    
    .nav-tabs .nav-link {
        color: #667eea;
        border: none;
        background: rgba(102, 126, 234, 0.1);
        margin-right: 5px;
        border-radius: 8px 8px 0 0;
    }
    
    .nav-tabs .nav-link.active {
        background: #667eea;
        color: white;
    }
    
    .tab-content {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 0 8px 8px 8px;
    }
</style>
{% endblock %}

{% block content %}
<div class="content-container">
    <div class="text-center mb-4">
        <h1><i class="fas fa-chart-line section-icon"></i> 資料說明與分析方法</h1>
        <p class="text-muted">深入了解 Starlink 衛星覆蓋分析的資料來源、計算方法和結果解讀</p>
    </div>
    
    <!-- 資料來源說明 -->
    <div class="section-card">
        <div class="section-title">
            <i class="fas fa-database section-icon"></i>
            資料來源說明
        </div>
        
        <div class="subsection">
            <h4><i class="fas fa-satellite"></i> TLE 資料來源</h4>
            <div class="data-source-item">
                <strong>主要來源：</strong> CelesTrak (celestrak.org)<br>
                <strong>備用來源：</strong> Space-Track.org<br>
                <strong>資料類型：</strong> Starlink 衛星群 Two-Line Element Sets<br>
                <strong>更新頻率：</strong> 每日多次更新，通常每 6-12 小時一次
            </div>
            
            <div class="highlight-box">
                <strong>資料品質保證：</strong> 系統會自動驗證 TLE 資料的完整性和時效性，
                確保軌道預測的準確性在 ±1 公里範圍內。
            </div>
        </div>
        
        <div class="subsection">
            <h4><i class="fas fa-globe"></i> 地理座標系統</h4>
            <p><strong>座標系統：</strong> WGS84 (World Geodetic System 1984)</p>
            <p><strong>台北觀測點：</strong> 緯度 25.03°N, 經度 121.57°E</p>
            <p><strong>海拔高度：</strong> 假設為海平面 (0 公尺)</p>
            
            <div class="warning-box">
                <strong>注意：</strong> 實際的 Starlink 用戶終端位置可能因建築物高度、
                地形等因素而有所差異，這可能影響實際的衛星可見性。
            </div>
        </div>
        
        <div class="subsection">
            <h4><i class="fas fa-clock"></i> 時間標準</h4>
            <p><strong>時間基準：</strong> UTC (協調世界時)</p>
            <p><strong>本地時間：</strong> UTC+8 (台北時間)</p>
            <p><strong>時間精度：</strong> 秒級精度</p>
        </div>
    </div>
    
    <!-- 分析方法說明 -->
    <div class="section-card">
        <div class="section-title">
            <i class="fas fa-calculator section-icon"></i>
            分析方法說明
        </div>
        
        <ul class="nav nav-tabs" id="methodTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="visibility-tab" data-bs-toggle="tab" data-bs-target="#visibility" type="button">
                    衛星可見性計算
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="coverage-tab" data-bs-toggle="tab" data-bs-target="#coverage" type="button">
                    覆蓋率計算
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="elevation-tab" data-bs-toggle="tab" data-bs-target="#elevation" type="button">
                    仰角計算
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="optimization-tab" data-bs-toggle="tab" data-bs-target="#optimization" type="button">
                    最佳化策略
                </button>
            </li>
        </ul>
        
        <div class="tab-content" id="methodTabsContent">
            <div class="tab-pane fade show active" id="visibility" role="tabpanel">
                <h4>衛星可見性判定原理</h4>
                <p>系統使用 SGP4 (Simplified General Perturbations 4) 模型預測衛星位置：</p>
                
                <div class="formula-box">
                    1. 從 TLE 資料解析軌道參數<br>
                    2. 使用 SGP4 模型計算衛星在指定時間的位置<br>
                    3. 轉換為地心地固座標系 (ECEF)<br>
                    4. 計算相對於觀測點的方位角和仰角<br>
                    5. 判定衛星是否在地平線以上 (仰角 > 最低仰角閾值)
                </div>
                
                <p><strong>最低仰角設定：</strong> 預設為 25°，可根據需求調整</p>
                <p><strong>計算間隔：</strong> 預設每 30 秒計算一次，確保捕捉衛星運動</p>
            </div>
            
            <div class="tab-pane fade" id="coverage" role="tabpanel">
                <h4>覆蓋率計算公式</h4>
                
                <div class="formula-box">
                    覆蓋率 (%) = (有衛星可見的時間點數 / 總時間點數) × 100
                </div>
                
                <p><strong>計算邏輯：</strong></p>
                <ul>
                    <li>將分析時間段分割為固定間隔 (預設 30 秒)</li>
                    <li>對每個時間點，檢查是否有至少一顆衛星可見</li>
                    <li>統計有衛星可見的時間點比例</li>
                </ul>
                
                <div class="highlight-box">
                    <strong>台北地區特色：</strong> 由於 Starlink 衛星密度高且軌道設計優良，
                    台北地區通常能達到 99-100% 的覆蓋率。
                </div>
            </div>
            
            <div class="tab-pane fade" id="elevation" role="tabpanel">
                <h4>仰角計算方法</h4>
                
                <div class="formula-box">
                    仰角 = arcsin(sin(φ_s) × sin(φ_o) + cos(φ_s) × cos(φ_o) × cos(λ_s - λ_o))<br><br>
                    其中：<br>
                    φ_s, λ_s = 衛星的緯度、經度<br>
                    φ_o, λ_o = 觀測點的緯度、經度
                </div>
                
                <p><strong>方位角計算：</strong></p>
                <div class="formula-box">
                    方位角 = arctan2(sin(λ_s - λ_o), cos(φ_o) × tan(φ_s) - sin(φ_o) × cos(λ_s - λ_o))
                </div>
                
                <p><strong>距離計算：</strong> 使用球面三角學計算衛星與觀測點的直線距離</p>
            </div>
            
            <div class="tab-pane fade" id="optimization" role="tabpanel">
                <h4>最佳連接策略</h4>
                
                <p><strong>最佳衛星選擇原則：</strong></p>
                <ol>
                    <li><strong>仰角優先：</strong> 選擇仰角最高的可見衛星</li>
                    <li><strong>穩定性考量：</strong> 避免選擇即將消失的衛星</li>
                    <li><strong>切換最小化：</strong> 減少不必要的衛星切換</li>
                </ol>
                
                <div class="highlight-box">
                    <strong>智能切換邏輯：</strong> 系統會預測衛星軌跡，
                    在當前衛星仰角開始下降時提前準備切換到更優的衛星。
                </div>
            </div>
        </div>
    </div>
    
    <!-- 結果解讀指南 -->
    <div class="section-card">
        <div class="section-title">
            <i class="fas fa-chart-pie section-icon"></i>
            結果解讀指南
        </div>
        
        <div class="subsection">
            <h4><i class="fas fa-file-alt"></i> HTML 分析報告</h4>
            <p>
                系統會生成一份詳細的 HTML 分析報告 (<code>report_r.html</code>)，該報告使用 R Markdown 製作，整合了所有關鍵分析結果。
                您可以從主頁下載此報告。
            </p>
            <ul>
                <li><strong>核心統計指標：</strong> 快速了解分析時段內的平均/最大/最小可見衛星數、整體覆蓋率及平均/最高衛星仰角。</li>
                <li><strong>視覺化圖表：</strong>
                    <ul>
                        <li><em>可見衛星數量時間序列圖：</em> 展示衛星數量隨時間的變化，有助於識別覆蓋高峰和低谷時段。</li>
                        <li><em>最大衛星仰角時間序列圖：</em> 顯示最佳可連接衛星的仰角變化，仰角越高通常訊號越好。</li>
                        <li><em>衛星覆蓋熱力圖 (互動式)：</em> 以顏色深淺表示不同時段的衛星可見數量，可直觀看出覆蓋模式。</li>
                    </ul>
                </li>
                <li><strong>原始數據樣本：</strong> 提供部分詳細的逐分鐘數據，用於進一步分析或驗證。</li>
            </ul>
        </div>

        <div class="subsection">
            <h4><i class="fas fa-table"></i> 統計圖表解讀</h4>
            
            <div class="row">
                <div class="col-md-6">
                    <h5>時間線圖表</h5>
                    <ul>
                        <li><strong>X 軸：</strong> 時間 (台北時間)</li>
                        <li><strong>Y 軸：</strong> 可見衛星數量或仰角</li>
                        <li><strong>藍色線：</strong> 可見衛星數量變化</li>
                        <li><strong>紅色線：</strong> 最佳連接仰角</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>統計摘要</h5>
                    <ul>
                        <li><strong>平均值：</strong> 整個分析期間的平均表現</li>
                        <li><strong>最大值：</strong> 觀測到的峰值</li>
                        <li><strong>標準差：</strong> 資料變異程度</li>
                        <li><strong>覆蓋率：</strong> 有衛星可見的時間比例</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="subsection">
            <h4><i class="fas fa-map"></i> 熱力圖解讀</h4>
            
            <div class="chart-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #d73027;"></div>
                    <span>高密度 (35+ 顆衛星)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fc8d59;"></div>
                    <span>中高密度 (25-35 顆)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fee08b;"></div>
                    <span>中等密度 (15-25 顆)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e0f3f8;"></div>
                    <span>低密度 (5-15 顆)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4575b4;"></div>
                    <span>極低密度 (<5 顆)</span>
                </div>
            </div>
            
            <div class="highlight-box">
                <strong>解讀要點：</strong> 熱力圖顯示不同時間段的衛星密度分布。
                紅色區域表示衛星密度最高的時段，藍色區域表示密度較低的時段。
            </div>
        </div>
        
        <div class="subsection">
            <h4><i class="fas fa-quality"></i> 資料品質指標</h4>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="data-source-item">
                        <strong>TLE 資料新鮮度</strong><br>
                        <small>理想：< 12 小時<br>可接受：< 24 小時</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="data-source-item">
                        <strong>計算精度</strong><br>
                        <small>位置誤差：< 1 km<br>時間精度：± 1 秒</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="data-source-item">
                        <strong>覆蓋完整性</strong><br>
                        <small>資料點：> 95%<br>時間連續性：無間斷</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 限制和假設 -->
    <div class="section-card">
        <div class="section-title">
            <i class="fas fa-exclamation-triangle section-icon"></i>
            限制和假設說明
        </div>
        
        <div class="warning-box">
            <h5>重要限制</h5>
            <ul>
                <li><strong>大氣影響：</strong> 未考慮大氣折射和天氣對信號的影響</li>
                <li><strong>地形遮蔽：</strong> 未考慮建築物、山脈等地形遮蔽效應</li>
                <li><strong>衛星狀態：</strong> 假設所有衛星都處於正常工作狀態</li>
                <li><strong>用戶終端：</strong> 假設用戶終端具備完美的追蹤能力</li>
            </ul>
        </div>
        
        <div class="highlight-box">
            <h5>模型假設</h5>
            <ul>
                <li>地球為完美球體 (忽略地球扁率)</li>
                <li>觀測點位於海平面</li>
                <li>衛星信號為直線傳播</li>
                <li>不考慮相對論效應</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 初始化 Bootstrap 標籤頁
    var triggerTabList = [].slice.call(document.querySelectorAll('#methodTabs button'))
    triggerTabList.forEach(function (triggerEl) {
        var tabTrigger = new bootstrap.Tab(triggerEl)
        
        triggerEl.addEventListener('click', function (event) {
            event.preventDefault()
            tabTrigger.show()
        })
    })
});
</script>
{% endblock %} 